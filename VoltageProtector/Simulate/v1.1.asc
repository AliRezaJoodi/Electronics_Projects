Version 4.1
SHEET 1 3400 2416
WIRE -944 -336 -1056 -336
WIRE -560 -336 -640 -336
WIRE -368 -336 -560 -336
WIRE -1056 -288 -1056 -336
WIRE -560 -272 -560 -336
WIRE -368 -208 -368 -336
WIRE -256 -192 -320 -192
WIRE -208 -192 -256 -192
WIRE -1056 -144 -1056 -208
WIRE -256 -144 -320 -144
WIRE -208 -144 -256 -144
WIRE -560 -112 -560 -192
WIRE 576 -96 464 -96
WIRE 640 -96 576 -96
WIRE 720 -96 640 -96
WIRE 800 -96 720 -96
WIRE 928 -96 880 -96
WIRE 1008 -96 928 -96
WIRE 1104 -96 1008 -96
WIRE 224 -64 192 -64
WIRE 336 -64 304 -64
WIRE 464 -64 464 -96
WIRE 576 -64 576 -96
WIRE -1280 64 -1408 64
WIRE -928 64 -1200 64
WIRE -560 64 -560 -48
WIRE -560 64 -656 64
WIRE -368 64 -368 -128
WIRE -368 64 -560 64
WIRE -272 64 -368 64
WIRE 64 64 -192 64
WIRE 192 64 192 -64
WIRE 192 64 64 64
WIRE 240 64 192 64
WIRE 336 64 336 -64
WIRE 336 64 304 64
WIRE 464 64 464 0
WIRE 464 64 336 64
WIRE -1408 96 -1408 64
WIRE 64 96 64 64
WIRE 48 112 -112 112
WIRE -112 128 -112 112
WIRE 640 128 640 -96
WIRE 928 128 928 -96
WIRE 1008 128 1008 -96
WIRE 48 144 32 144
WIRE -112 224 -112 208
WIRE 32 224 32 144
WIRE 32 224 -112 224
WIRE -1408 256 -1408 176
WIRE -944 272 -992 272
WIRE 64 272 64 160
WIRE 64 272 -640 272
WIRE 576 272 576 0
WIRE 576 272 64 272
WIRE 464 352 464 64
WIRE 576 352 576 272
WIRE -1408 368 -1408 336
WIRE 464 464 464 416
WIRE 576 464 576 416
WIRE 576 464 464 464
WIRE 640 464 640 192
WIRE 640 464 576 464
WIRE 928 464 928 192
WIRE 928 464 640 464
WIRE 1008 464 1008 192
WIRE 1008 464 928 464
WIRE -1408 480 -1408 448
WIRE -992 480 -992 272
WIRE -992 480 -1408 480
WIRE 1008 496 1008 464
WIRE -1456 784 -1456 720
WIRE 640 832 640 784
WIRE -320 880 -384 880
WIRE -176 880 -240 880
WIRE -1456 912 -1456 864
WIRE -1312 912 -1456 912
WIRE -1168 912 -1248 912
WIRE -1040 912 -1168 912
WIRE -944 912 -1040 912
WIRE -1456 960 -1456 912
WIRE -1168 960 -1168 912
WIRE -1040 960 -1040 912
WIRE 640 960 640 912
WIRE -288 1056 -288 1008
WIRE -1168 1072 -1168 1040
WIRE -1040 1072 -1040 1024
WIRE -384 1072 -384 880
WIRE -384 1072 -480 1072
WIRE -320 1072 -384 1072
WIRE 992 1072 992 1024
WIRE -1456 1088 -1456 1040
WIRE -176 1088 -176 880
WIRE -176 1088 -256 1088
WIRE -64 1088 -176 1088
WIRE -320 1104 -480 1104
WIRE 448 1136 384 1136
WIRE 576 1136 512 1136
WIRE -288 1184 -288 1120
WIRE 1152 1184 1152 1136
WIRE 576 1200 576 1136
WIRE 640 1200 640 1024
WIRE 640 1200 576 1200
WIRE 1120 1200 640 1200
WIRE 1280 1216 1184 1216
WIRE 1408 1216 1280 1216
WIRE 1568 1216 1472 1216
WIRE 992 1232 992 1152
WIRE 1120 1232 992 1232
WIRE 448 1264 384 1264
WIRE 576 1264 576 1200
WIRE 576 1264 512 1264
WIRE 992 1280 992 1232
WIRE -1456 1296 -1456 1248
WIRE 1568 1296 1568 1216
WIRE 1152 1312 1152 1248
WIRE 2288 1312 2288 1248
WIRE -320 1344 -384 1344
WIRE -176 1344 -240 1344
WIRE 1984 1344 1984 1296
WIRE 1280 1360 1280 1216
WIRE 2288 1360 2288 1312
WIRE 2288 1360 2192 1360
WIRE 2288 1392 2288 1360
WIRE -1456 1408 -1456 1376
WIRE -1328 1408 -1456 1408
WIRE -1056 1408 -1328 1408
WIRE 992 1408 992 1360
WIRE 2192 1408 2192 1360
WIRE -1456 1440 -1456 1408
WIRE -1328 1456 -1328 1408
WIRE -1056 1472 -1056 1408
WIRE 1984 1488 1984 1424
WIRE 2192 1504 2192 1472
WIRE 2288 1504 2288 1472
WIRE 2288 1504 2192 1504
WIRE -272 1520 -272 1472
WIRE 1280 1520 1280 1424
WIRE 1280 1520 944 1520
WIRE -384 1536 -384 1344
WIRE -384 1536 -480 1536
WIRE -304 1536 -384 1536
WIRE -176 1552 -176 1344
WIRE -176 1552 -240 1552
WIRE -64 1552 -176 1552
WIRE -1456 1568 -1456 1504
WIRE -304 1568 -480 1568
WIRE 2288 1568 2288 1504
WIRE -1328 1600 -1328 1536
WIRE -1248 1600 -1328 1600
WIRE -1056 1600 -1056 1552
WIRE -992 1600 -1056 1600
WIRE 304 1600 304 1552
WIRE 1984 1632 1984 1552
WIRE 2288 1632 2288 1568
WIRE 2288 1632 1984 1632
WIRE -1328 1648 -1328 1600
WIRE -1056 1648 -1056 1600
WIRE -272 1648 -272 1584
WIRE 2288 1664 2288 1632
WIRE 2432 1664 2288 1664
WIRE 2288 1696 2288 1664
WIRE 1152 1712 1152 1664
WIRE 2432 1712 2432 1664
WIRE 304 1728 304 1680
WIRE 464 1728 304 1728
WIRE 640 1728 640 1200
WIRE 704 1728 640 1728
WIRE 848 1728 848 1680
WIRE 848 1728 768 1728
WIRE 944 1728 944 1520
WIRE 944 1728 848 1728
WIRE 1120 1728 944 1728
WIRE 1280 1744 1184 1744
WIRE 1568 1744 1568 1376
WIRE 1568 1744 1280 1744
WIRE 1712 1744 1568 1744
WIRE 2064 1744 1968 1744
WIRE 2224 1744 2144 1744
WIRE 1120 1760 1056 1760
WIRE -1328 1776 -1328 1728
WIRE -1056 1776 -1056 1728
WIRE 304 1776 304 1728
WIRE 2288 1824 2288 1792
WIRE 2432 1824 2432 1776
WIRE 2432 1824 2288 1824
WIRE 1152 1840 1152 1776
WIRE 304 1888 304 1840
WIRE 2288 1904 2288 1824
WIRE 944 1952 944 1728
WIRE 1120 1952 944 1952
WIRE 1280 1952 1280 1744
WIRE 1280 1952 1184 1952
FLAG -928 64 LINE_IN
IOPIN -928 64 Out
FLAG -944 272 NEUTRAL
IOPIN -944 272 Out
FLAG 1104 -96 VDD2
IOPIN 1104 -96 Out
FLAG -1456 720 LINE_IN
FLAG -1456 1088 0
FLAG -1168 1072 0
FLAG -1040 1072 0
FLAG -944 912 AC_MEASURE
IOPIN -944 912 Out
FLAG -288 1008 VDD2
FLAG -288 1184 0
FLAG -480 1104 AC_MEASURE
IOPIN -480 1104 In
FLAG -272 1472 VDD2
FLAG -272 1648 0
FLAG -480 1536 AC_MEASURE
IOPIN -480 1536 In
FLAG -1328 1776 0
FLAG -1456 1568 0
FLAG -1456 1248 VDD2
FLAG 1008 496 0
FLAG -992 1600 REF_H
IOPIN -992 1600 Out
FLAG -480 1072 REF_H
IOPIN -480 1072 In
FLAG -480 1568 REF_L
IOPIN -480 1568 In
FLAG -1248 1600 REF_L
IOPIN -1248 1600 Out
FLAG -64 1088 STATUS_H
IOPIN -64 1088 Out
FLAG -64 1552 STATUS_L
IOPIN -64 1552 Out
FLAG 2288 1248 VDD
FLAG 2288 1904 0
FLAG 1968 1744 RELAY
IOPIN 1968 1744 In
FLAG 1152 1664 VDD2
FLAG 1152 1840 0
FLAG 1152 1136 VDD2
FLAG 1152 1312 0
FLAG 384 1136 STATUS_H
IOPIN 384 1136 In
FLAG 384 1264 STATUS_L
IOPIN 384 1264 In
FLAG 640 784 VDD2
FLAG 992 1408 0
FLAG 992 1024 VDD2
FLAG 1712 1744 RELAY
IOPIN 1712 1744 Out
FLAG -1056 1776 0
FLAG 1056 1760 REF_H
IOPIN 1056 1760 In
FLAG 304 1888 0
FLAG 304 1552 VDD2
FLAG 464 1728 RC
IOPIN 464 1728 Out
FLAG 848 1680 RC
IOPIN 848 1680 In
FLAG 720 -96 VDD
FLAG 1984 1296 VDD
FLAG -944 -336 LINE_OUT
IOPIN -944 -336 In
FLAG 2288 1312 RLY_P
FLAG 2288 1568 RLY_N
FLAG -256 -192 RLY_P
FLAG -256 -144 RLY_N
FLAG -1056 -144 NEUTRAL
FLAG -640 -336 LINE_OUT
IOPIN -640 -336 Out
FLAG -656 64 LINE_IN
IOPIN -656 64 In
FLAG -640 272 NEUTRAL
IOPIN -640 272 In
SYMBOL voltage -1408 80 R0
WINDOW 0 41 43 Left 2
WINDOW 3 46 56 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value SINE(0 {Vrms*1.414} 50)
SYMBOL cap 240 80 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C1
SYMATTR Value 680n
SYMATTR SpiceLine V=400
SYMBOL res 208 -48 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R1
SYMATTR Value 470k
SYMBOL diode 480 0 R180
WINDOW 0 46 38 Left 2
WINDOW 3 47 10 Left 2
SYMATTR InstName D1
SYMBOL diode 480 416 R180
WINDOW 0 47 63 Left 2
WINDOW 3 47 35 Left 2
SYMATTR InstName D2
SYMBOL diode 592 0 R180
WINDOW 0 42 34 Left 2
WINDOW 3 43 7 Left 2
SYMATTR InstName D3
SYMBOL diode 592 416 R180
WINDOW 0 41 66 Left 2
WINDOW 3 44 38 Left 2
SYMATTR InstName D4
SYMBOL cap 624 128 R0
WINDOW 0 49 15 Left 2
WINDOW 3 44 38 Left 2
SYMATTR InstName C2
SYMATTR Value 220µ
SYMATTR SpiceLine V=35
SYMBOL zener 944 192 R180
WINDOW 0 48 37 Left 2
WINDOW 3 45 12 Invisible 2
SYMATTR InstName D5
SYMATTR Value BZX84B9V1LY
SYMBOL res 784 -80 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R4
SYMATTR Value 330
SYMATTR SpiceLine pwr=2
SYMBOL cap 992 128 R0
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL res -1472 768 R0
SYMATTR InstName R2
SYMATTR Value 220k
SYMATTR SpiceLine tol=1 pwr=1/4
SYMBOL res -1472 944 R0
SYMATTR InstName R3
SYMATTR Value 4k
SYMATTR SpiceLine tol=1 pwr=1/4
SYMBOL diode -1312 928 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D6
SYMATTR Value 1N4148
SYMBOL res -1184 944 R0
SYMATTR InstName R5
SYMATTR Value 120k
SYMBOL cap -1056 960 R0
SYMATTR InstName C4
SYMATTR Value 22µ
SYMBOL MyLib\\OpAmp\\LM358 -288 1024 R0
WINDOW 38 16 96 Invisible 2
SYMATTR InstName U1
SYMBOL MyLib\\OpAmp\\LM358 -272 1488 R0
WINDOW 38 16 96 Invisible 2
SYMATTR InstName U2
SYMBOL res -1072 1456 R0
SYMATTR InstName R6
SYMATTR Value 4.7k
SYMBOL res -1344 1440 R0
SYMATTR InstName R7
SYMATTR Value 6.8k
SYMBOL res -224 864 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 1Meg
SYMBOL res -224 1328 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 1Meg
SYMBOL res -1344 1632 R0
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL zener -1440 1504 R180
WINDOW 0 49 40 Left 2
WINDOW 3 49 16 Left 2
SYMATTR InstName D7
SYMATTR Value UMZ5_1N
SYMBOL res -1472 1280 R0
SYMATTR InstName R11
SYMATTR Value 220
SYMBOL ind 2272 1376 R0
WINDOW 3 36 80 Invisible 2
WINDOW 0 44 40 Left 2
SYMATTR Value 25m
SYMATTR InstName RELAY_COIL
SYMATTR SpiceLine Rser=400
SYMBOL npn 2224 1696 R0
SYMATTR InstName Q1
SYMATTR Value BC547B
SYMBOL diode 2208 1472 R180
WINDOW 0 49 40 Left 2
WINDOW 3 48 16 Left 2
SYMATTR InstName D9
SYMATTR Value 1N4148
SYMBOL res 2048 1760 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R12
SYMATTR Value 10k
SYMBOL MyLib\\OpAmp\\LM358 1152 1680 R0
WINDOW 38 16 96 Invisible 2
SYMATTR InstName U3
SYMBOL MyLib\\OpAmp\\LM358 1152 1152 R0
WINDOW 38 16 96 Invisible 2
SYMATTR InstName U4
SYMBOL diode 512 1120 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D8
SYMATTR Value 1N4148
SYMBOL diode 512 1248 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D10
SYMATTR Value 1N4148
SYMBOL res 624 816 R0
SYMATTR InstName R13
SYMATTR Value 4.7k
SYMBOL res 976 1056 R0
SYMATTR InstName R14
SYMATTR Value 150k
SYMATTR SpiceLine tol=5
SYMBOL res 976 1264 R0
SYMATTR InstName R15
SYMATTR Value 470k
SYMATTR SpiceLine tol=5
SYMBOL diode 1296 1424 R180
WINDOW 0 49 40 Left 2
WINDOW 3 48 16 Left 2
SYMATTR InstName D11
SYMATTR Value 1N4148
SYMBOL res 1552 1280 R0
SYMATTR InstName R16
SYMATTR Value 2.2k
SYMBOL diode 1184 1936 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D12
SYMATTR Value 1N4148
SYMBOL res -1072 1632 R0
SYMATTR InstName R17
SYMATTR Value 470k
SYMBOL diode 768 1712 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D13
SYMATTR Value 1N4148
SYMBOL cap 288 1776 R0
SYMATTR InstName C5
SYMATTR Value 22µ
SYMBOL res 288 1584 R0
SYMATTR InstName R18
SYMATTR Value 220K
SYMBOL LED 624 960 R0
WINDOW 0 -121 13 Left 2
WINDOW 3 -60 35 Left 2
SYMATTR InstName LED_RED
SYMATTR Value LED
SYMBOL LED 1408 1232 R270
WINDOW 0 -33 27 VTop 2
WINDOW 3 -30 31 VBottom 2
SYMATTR InstName LED_YELLOW
SYMATTR Value LED
SYMBOL LED 1968 1488 R0
WINDOW 0 -152 23 Left 2
WINDOW 3 -62 48 Left 2
SYMATTR InstName LED_GREEN
SYMATTR Value LED
SYMBOL voltage -1408 352 R180
WINDOW 0 -43 72 Right 2
WINDOW 3 46 56 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value SINE(0 {DECR*1.414} 50 0 0 0 100)
SYMBOL voltage -1408 352 R0
WINDOW 0 75 39 Right 2
WINDOW 3 46 56 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value SINE(0 {INCR*1.414} 50 10 0 0 100)
SYMBOL res 1968 1328 R0
SYMATTR InstName R19
SYMATTR Value 2.2k
SYMBOL res -288 80 R270
WINDOW 0 42 56 VTop 2
WINDOW 3 0 56 Invisible 2
SYMATTR InstName Fuse
SYMATTR Value 0.01
SYMBOL SpecialFunctions\\varistor 80 192 M180
WINDOW 0 7 72 Left 2
SYMATTR InstName A1
SYMBOL voltage -112 112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 470V
SYMBOL sw -368 -112 R180
WINDOW 0 51 41 Left 2
WINDOW 3 48 70 Left 2
SYMATTR InstName S1
SYMBOL res -576 -288 R0
SYMATTR InstName R20
SYMATTR Value 120
SYMATTR SpiceLine pwr=2
SYMBOL cap -576 -112 R0
SYMATTR InstName C6
SYMATTR Value 100n
SYMATTR SpiceLine V=400
SYMBOL diode 2416 1776 M180
WINDOW 0 49 40 Left 2
WINDOW 3 48 16 Left 2
SYMATTR InstName D14
SYMATTR Value 1N4148
SYMBOL res -1072 -304 R0
SYMATTR InstName LOAD
SYMATTR Value 500
SYMBOL res -1296 80 R270
WINDOW 0 44 58 VTop 2
WINDOW 3 0 56 Invisible 2
SYMATTR InstName Fuse_Load
SYMATTR Value 0.01
TEXT -696 400 Left 2 !.tran 0 12 0 0.1
TEXT -152 1016 Left 2 ;Normal = High\nAbnormal = Low
TEXT -152 1488 Left 2 ;Normal = High\nAbnormal = Low
TEXT 336 1672 Left 2 ;3.9Meg
TEXT -696 432 Left 2 !.model LED D(IS=2e-19 N=2 RS=5 BV=30 IBV=1e-3)
TEXT 408 1776 Left 2 ;.ic V(RC)=0
TEXT -1368 144 Left 2 !.param Vrms=220
TEXT -1264 336 Right 2 ;Reducer
TEXT -1360 448 Left 2 ;Increaser
TEXT -1368 304 Left 2 !.param DECR=70
TEXT -1368 416 Left 2 !.param INCR=60
TEXT 848 184 Left 2 ;9V1\n1W
TEXT 816 -40 Left 2 ;1W
TEXT 88 144 Left 2 ;MOV\n10D471K
TEXT -272 104 Left 2 ;250mA
TEXT -944 872 Left 2 ;x53
TEXT -992 1568 Left 2 ;270Vrms
TEXT -1256 1568 Left 2 ;160Vrms
TEXT -528 -200 Left 2 ;2W
TEXT -528 -48 Left 2 ;400V
TEXT -696 464 Left 2 !.model SW SW(Ron=1u Roff=100Meg Vt=5)
TEXT -1264 0 Left 2 ;5A
TEXT -344 -112 Left 2 ;S1=Relay Contact
TEXT -1464 -424 Left 3 ;External Circuit
TEXT 672 192 Left 2 ;35V
TEXT -696 504 Left 2 ;GitHub.com/AliRezaJoodi
RECTANGLE Normal -1472 528 -800 -400 2
