Version 4.1
SHEET 1 3400 2416
WIRE -944 -336 -1056 -336
WIRE -560 -336 -640 -336
WIRE -368 -336 -560 -336
WIRE -1056 -288 -1056 -336
WIRE -560 -272 -560 -336
WIRE -368 -208 -368 -336
WIRE -256 -192 -320 -192
WIRE -208 -192 -256 -192
WIRE -1056 -144 -1056 -208
WIRE -256 -144 -320 -144
WIRE -208 -144 -256 -144
WIRE -560 -112 -560 -192
WIRE 576 -96 464 -96
WIRE 640 -96 576 -96
WIRE 784 -96 640 -96
WIRE 912 -96 784 -96
WIRE 960 -96 912 -96
WIRE 1088 -96 960 -96
WIRE 1216 -96 1168 -96
WIRE 1296 -96 1216 -96
WIRE 1360 -96 1296 -96
WIRE 1408 -96 1360 -96
WIRE 224 -64 192 -64
WIRE 336 -64 304 -64
WIRE 464 -64 464 -96
WIRE 576 -64 576 -96
WIRE -1280 64 -1408 64
WIRE -928 64 -1200 64
WIRE -560 64 -560 -48
WIRE -560 64 -656 64
WIRE -368 64 -368 -128
WIRE -368 64 -560 64
WIRE -272 64 -368 64
WIRE 64 64 -192 64
WIRE 192 64 192 -64
WIRE 192 64 64 64
WIRE 240 64 192 64
WIRE 336 64 336 -64
WIRE 336 64 304 64
WIRE 464 64 464 0
WIRE 464 64 336 64
WIRE -1408 96 -1408 64
WIRE 64 96 64 64
WIRE 48 112 -112 112
WIRE -112 128 -112 112
WIRE 640 128 640 -96
WIRE 784 128 784 -96
WIRE 912 128 912 -96
WIRE 1216 128 1216 -96
WIRE 1296 128 1296 -96
WIRE 48 144 32 144
WIRE -112 224 -112 208
WIRE 32 224 32 144
WIRE 32 224 -112 224
WIRE -1408 256 -1408 176
WIRE -944 272 -992 272
WIRE 64 272 64 160
WIRE 64 272 -640 272
WIRE 224 272 64 272
WIRE 576 272 576 0
WIRE 576 272 304 272
WIRE 464 352 464 64
WIRE 576 352 576 272
WIRE -1408 368 -1408 336
WIRE 464 464 464 416
WIRE 576 464 576 416
WIRE 576 464 464 464
WIRE 640 464 640 192
WIRE 640 464 576 464
WIRE 784 464 784 192
WIRE 784 464 640 464
WIRE 912 464 912 192
WIRE 912 464 784 464
WIRE 1216 464 1216 192
WIRE 1216 464 912 464
WIRE 1296 464 1296 192
WIRE 1296 464 1216 464
WIRE 1392 464 1296 464
WIRE -1408 480 -1408 448
WIRE -992 480 -992 272
WIRE -992 480 -1408 480
WIRE 1392 512 1392 464
WIRE -1456 784 -1456 720
WIRE -320 880 -384 880
WIRE -176 880 -240 880
WIRE -1456 912 -1456 864
WIRE -1312 912 -1456 912
WIRE -1168 912 -1248 912
WIRE -1040 912 -1168 912
WIRE -944 912 -1040 912
WIRE 640 912 640 864
WIRE -1456 960 -1456 912
WIRE -1168 960 -1168 912
WIRE -1040 960 -1040 912
WIRE 640 1040 640 992
WIRE -288 1056 -288 1008
WIRE -1168 1072 -1168 1040
WIRE -1040 1072 -1040 1024
WIRE -384 1072 -384 880
WIRE -384 1072 -480 1072
WIRE -320 1072 -384 1072
WIRE 992 1072 992 1024
WIRE -1456 1088 -1456 1040
WIRE -176 1088 -176 880
WIRE -176 1088 -256 1088
WIRE -64 1088 -176 1088
WIRE -320 1104 -480 1104
WIRE 384 1136 320 1136
WIRE 512 1136 448 1136
WIRE -288 1184 -288 1120
WIRE 1152 1184 1152 1136
WIRE 512 1200 512 1136
WIRE 640 1200 640 1104
WIRE 640 1200 512 1200
WIRE 1120 1200 640 1200
WIRE 1312 1216 1184 1216
WIRE 1408 1216 1312 1216
WIRE 1568 1216 1472 1216
WIRE 992 1232 992 1152
WIRE 1120 1232 992 1232
WIRE 2288 1232 2288 1168
WIRE 384 1264 320 1264
WIRE 512 1264 512 1200
WIRE 512 1264 448 1264
WIRE 992 1280 992 1232
WIRE 2288 1280 2288 1232
WIRE 2288 1280 2192 1280
WIRE -1456 1296 -1456 1248
WIRE 1568 1296 1568 1216
WIRE 1152 1312 1152 1248
WIRE 2288 1312 2288 1280
WIRE 1312 1328 1312 1216
WIRE 2192 1328 2192 1280
WIRE -320 1344 -384 1344
WIRE -176 1344 -240 1344
WIRE -1456 1408 -1456 1376
WIRE -1328 1408 -1456 1408
WIRE -1056 1408 -1328 1408
WIRE 992 1408 992 1360
WIRE 2192 1424 2192 1392
WIRE 2288 1424 2288 1392
WIRE 2288 1424 2192 1424
WIRE -1456 1440 -1456 1408
WIRE -1328 1456 -1328 1408
WIRE 1312 1456 1312 1392
WIRE 1312 1456 944 1456
WIRE -1056 1472 -1056 1408
WIRE 208 1488 208 1440
WIRE 2288 1488 2288 1424
WIRE -272 1520 -272 1472
WIRE -384 1536 -384 1344
WIRE -384 1536 -480 1536
WIRE -304 1536 -384 1536
WIRE -176 1552 -176 1344
WIRE -176 1552 -240 1552
WIRE -64 1552 -176 1552
WIRE -1456 1568 -1456 1504
WIRE -304 1568 -480 1568
WIRE 2288 1584 2288 1488
WIRE 2432 1584 2288 1584
WIRE -1328 1600 -1328 1536
WIRE -1248 1600 -1328 1600
WIRE -1056 1600 -1056 1552
WIRE -992 1600 -1056 1600
WIRE 2288 1616 2288 1584
WIRE 1152 1632 1152 1584
WIRE 2432 1632 2432 1584
WIRE -1328 1648 -1328 1600
WIRE -1056 1648 -1056 1600
WIRE -272 1648 -272 1584
WIRE 208 1648 208 1568
WIRE 368 1648 208 1648
WIRE 640 1648 640 1200
WIRE 704 1648 640 1648
WIRE 848 1648 848 1600
WIRE 848 1648 768 1648
WIRE 944 1648 944 1456
WIRE 944 1648 848 1648
WIRE 1120 1648 944 1648
WIRE 1280 1664 1184 1664
WIRE 1568 1664 1568 1376
WIRE 1568 1664 1280 1664
WIRE 1712 1664 1568 1664
WIRE 2064 1664 1968 1664
WIRE 2224 1664 2144 1664
WIRE 1120 1680 1056 1680
WIRE 208 1696 208 1648
WIRE 2288 1744 2288 1712
WIRE 2432 1744 2432 1696
WIRE 2432 1744 2288 1744
WIRE 1152 1760 1152 1696
WIRE -1328 1776 -1328 1728
WIRE -1056 1776 -1056 1728
WIRE 2288 1792 2288 1744
WIRE 2288 1792 2128 1792
WIRE 208 1808 208 1760
WIRE 2128 1824 2128 1792
WIRE 2288 1824 2288 1792
WIRE 944 1840 944 1648
WIRE 1120 1840 944 1840
WIRE 1280 1840 1280 1664
WIRE 1280 1840 1184 1840
WIRE 2128 1936 2128 1904
WIRE 2288 1936 2288 1888
WIRE 2288 1936 2128 1936
WIRE 2288 1984 2288 1936
FLAG -928 64 LINE_IN
IOPIN -928 64 Out
FLAG -944 272 NEUTRAL
IOPIN -944 272 Out
FLAG -1456 720 LINE_IN
FLAG -1456 1088 0
FLAG -1168 1072 0
FLAG -1040 1072 0
FLAG -944 912 AC_MEASURE
IOPIN -944 912 Out
FLAG -288 1008 VDD2
FLAG -288 1184 0
FLAG -480 1104 AC_MEASURE
IOPIN -480 1104 In
FLAG -272 1472 VDD2
FLAG -272 1648 0
FLAG -480 1536 AC_MEASURE
IOPIN -480 1536 In
FLAG -1328 1776 0
FLAG -1456 1568 0
FLAG -1456 1248 VDD2
FLAG 1392 512 0
FLAG -992 1600 REF_H
IOPIN -992 1600 Out
FLAG -480 1072 REF_H
IOPIN -480 1072 In
FLAG -480 1568 REF_L
IOPIN -480 1568 In
FLAG -1248 1600 REF_L
IOPIN -1248 1600 Out
FLAG -64 1088 STATUS_H
IOPIN -64 1088 Out
FLAG -64 1552 STATUS_L
IOPIN -64 1552 Out
FLAG 2288 1168 VDD
FLAG 2288 1984 0
FLAG 1968 1664 RELAY
IOPIN 1968 1664 In
FLAG 1152 1584 VDD2
FLAG 1152 1760 0
FLAG 1152 1136 VDD2
FLAG 1152 1312 0
FLAG 320 1136 STATUS_H
IOPIN 320 1136 In
FLAG 320 1264 STATUS_L
IOPIN 320 1264 In
FLAG 640 864 VDD2
FLAG 992 1408 0
FLAG 992 1024 VDD2
FLAG 1712 1664 RELAY
IOPIN 1712 1664 Out
FLAG -1056 1776 0
FLAG 1056 1680 REF_H
IOPIN 1056 1680 In
FLAG 208 1808 0
FLAG 208 1440 VDD2
FLAG 368 1648 RC
IOPIN 368 1648 Out
FLAG 848 1600 RC
IOPIN 848 1600 In
FLAG 960 -96 VDD
FLAG -944 -336 LINE_OUT
IOPIN -944 -336 In
FLAG 2288 1232 RLY_P
FLAG 2288 1488 RLY_N
FLAG -256 -192 RLY_P
FLAG -256 -144 RLY_N
FLAG -1056 -144 NEUTRAL
FLAG -640 -336 LINE_OUT
IOPIN -640 -336 Out
FLAG -656 64 LINE_IN
IOPIN -656 64 In
FLAG -640 272 NEUTRAL
IOPIN -640 272 In
FLAG 1360 -96 VDD2
SYMBOL voltage -1408 80 R0
WINDOW 0 41 43 Left 2
WINDOW 3 46 56 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value SINE(0 {Vrms*1.414} 50)
SYMBOL cap 240 80 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C1
SYMATTR Value 680n
SYMATTR SpiceLine V=400
SYMBOL res 208 -48 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R1
SYMATTR Value 470k
SYMBOL diode 480 0 R180
WINDOW 0 46 38 Left 2
WINDOW 3 47 10 Left 2
SYMATTR InstName D1
SYMBOL diode 480 416 R180
WINDOW 0 47 63 Left 2
WINDOW 3 47 35 Left 2
SYMATTR InstName D2
SYMBOL diode 592 0 R180
WINDOW 0 42 34 Left 2
WINDOW 3 43 7 Left 2
SYMATTR InstName D3
SYMBOL diode 592 416 R180
WINDOW 0 41 66 Left 2
WINDOW 3 44 38 Left 2
SYMATTR InstName D4
SYMBOL cap 624 128 R0
WINDOW 0 49 15 Left 2
WINDOW 3 44 38 Left 2
SYMATTR InstName C2
SYMATTR Value 220µ
SYMATTR SpiceLine V=35
SYMBOL zener 800 192 R180
WINDOW 0 -49 40 Left 2
WINDOW 3 45 12 Invisible 2
SYMATTR InstName D5
SYMATTR Value BZX84C12L
SYMBOL res 208 288 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R4
SYMATTR Value 100
SYMATTR SpiceLine pwr=2
SYMBOL cap 896 128 R0
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL res -1472 768 R0
SYMATTR InstName R2
SYMATTR Value 220k
SYMATTR SpiceLine tol=1 pwr=1/4
SYMBOL res -1472 944 R0
SYMATTR InstName R3
SYMATTR Value 4k
SYMATTR SpiceLine tol=1 pwr=1/4
SYMBOL diode -1312 928 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D6
SYMATTR Value 1N4148
SYMBOL res -1184 944 R0
SYMATTR InstName R5
SYMATTR Value 120k
SYMBOL cap -1056 960 R0
SYMATTR InstName C4
SYMATTR Value 22µ
SYMBOL MyLib\\OpAmp\\LM358 -288 1024 R0
WINDOW 38 16 96 Invisible 2
SYMATTR InstName U1
SYMBOL MyLib\\OpAmp\\LM358 -272 1488 R0
WINDOW 38 16 96 Invisible 2
SYMATTR InstName U2
SYMBOL res -1072 1456 R0
SYMATTR InstName R6
SYMATTR Value 4.7k
SYMBOL res -1344 1440 R0
SYMATTR InstName R7
SYMATTR Value 6.8k
SYMBOL res -224 864 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 470k
SYMBOL res -224 1328 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 1Meg
SYMBOL res -1344 1632 R0
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL zener -1440 1504 R180
WINDOW 0 49 40 Left 2
WINDOW 3 49 16 Left 2
SYMATTR InstName D7
SYMATTR Value UMZ5_1N
SYMBOL res -1472 1280 R0
SYMATTR InstName R11
SYMATTR Value 220
SYMBOL ind 2272 1296 R0
WINDOW 3 36 80 Invisible 2
WINDOW 0 44 40 Left 2
SYMATTR Value 25m
SYMATTR InstName RELAY_COIL
SYMATTR SpiceLine Rser=400
SYMBOL npn 2224 1616 R0
SYMATTR InstName Q1
SYMATTR Value BC547B
SYMBOL diode 2208 1392 R180
WINDOW 0 49 40 Left 2
WINDOW 3 48 16 Left 2
SYMATTR InstName D9
SYMATTR Value 1N4148
SYMBOL res 2048 1680 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R12
SYMATTR Value 10k
SYMBOL MyLib\\OpAmp\\LM358 1152 1600 R0
WINDOW 38 16 96 Invisible 2
SYMATTR InstName U3
SYMBOL MyLib\\OpAmp\\LM358 1152 1152 R0
WINDOW 38 16 96 Invisible 2
SYMATTR InstName U4
SYMBOL diode 448 1120 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D8
SYMATTR Value 1N4148
SYMBOL diode 448 1248 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D10
SYMATTR Value 1N4148
SYMBOL res 624 896 R0
SYMATTR InstName R13
SYMATTR Value 4.7k
SYMBOL res 976 1056 R0
SYMATTR InstName R14
SYMATTR Value 150k
SYMATTR SpiceLine tol=5
SYMBOL res 976 1264 R0
SYMATTR InstName R15
SYMATTR Value 470k
SYMATTR SpiceLine tol=5
SYMBOL diode 1328 1392 R180
WINDOW 0 49 40 Left 2
WINDOW 3 48 16 Left 2
SYMATTR InstName D11
SYMATTR Value 1N4148
SYMBOL res 1552 1280 R0
SYMATTR InstName R16
SYMATTR Value 2.2k
SYMBOL diode 1184 1824 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D12
SYMATTR Value 1N4148
SYMBOL res -1072 1632 R0
SYMATTR InstName R17
SYMATTR Value 470k
SYMBOL diode 768 1632 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D13
SYMATTR Value 1N4148
SYMBOL cap 192 1696 R0
SYMATTR InstName C5
SYMATTR Value 22µ
SYMBOL res 192 1472 R0
SYMATTR InstName R18
SYMATTR Value 220K
SYMBOL LED 624 1040 R0
WINDOW 0 -121 13 Left 2
WINDOW 3 -60 35 Left 2
SYMATTR InstName LED_RED
SYMATTR Value LED
SYMBOL LED 1408 1232 R270
WINDOW 0 -33 27 VTop 2
WINDOW 3 -30 31 VBottom 2
SYMATTR InstName LED_YELLOW
SYMATTR Value LED
SYMBOL LED 2304 1824 M0
WINDOW 0 -152 23 Left 2
WINDOW 3 -62 48 Left 2
SYMATTR InstName LED_GREEN
SYMATTR Value LED
SYMBOL voltage -1408 352 R180
WINDOW 0 -43 72 Right 2
WINDOW 3 46 56 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value SINE(0 {DECR*1.414} 50 0 0 0 100)
SYMBOL voltage -1408 352 R0
WINDOW 0 75 39 Right 2
WINDOW 3 46 56 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value SINE(0 {INCR*1.414} 50 10 0 0 100)
SYMBOL res -288 80 R270
WINDOW 0 42 56 VTop 2
WINDOW 3 0 56 Invisible 2
SYMATTR InstName Fuse
SYMATTR Value 0.01
SYMBOL SpecialFunctions\\varistor 80 192 M180
WINDOW 0 7 72 Left 2
SYMATTR InstName A1
SYMBOL voltage -112 112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 470V
SYMBOL sw -368 -112 R180
WINDOW 0 51 41 Left 2
WINDOW 3 48 70 Left 2
SYMATTR InstName S1
SYMBOL res -576 -288 R0
SYMATTR InstName R20
SYMATTR Value 120
SYMATTR SpiceLine pwr=2
SYMBOL cap -576 -112 R0
SYMATTR InstName C6
SYMATTR Value 100n
SYMATTR SpiceLine V=400
SYMBOL diode 2416 1696 M180
WINDOW 0 49 40 Left 2
WINDOW 3 48 16 Left 2
SYMATTR InstName D14
SYMATTR Value 1N4148
SYMBOL res -1072 -304 R0
SYMATTR InstName LOAD
SYMATTR Value 500
SYMBOL res -1296 80 R270
WINDOW 0 44 58 VTop 2
WINDOW 3 0 56 Invisible 2
SYMATTR InstName Fuse_Load
SYMATTR Value 0.01
SYMBOL res 1072 -80 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R21
SYMATTR Value 100
SYMBOL zener 1232 192 R180
WINDOW 0 48 37 Left 2
WINDOW 3 45 12 Invisible 2
SYMATTR InstName D15
SYMATTR Value BZX84B9V1LY
SYMBOL cap 1280 128 R0
SYMATTR InstName C7
SYMATTR Value 100n
SYMBOL res 2112 1808 R0
SYMATTR InstName R19
SYMATTR Value 330
TEXT -696 400 Left 2 !.tran 0 12 0 0.1
TEXT -152 1016 Left 2 ;Normal = High\nAbnormal = Low
TEXT -152 1488 Left 2 ;Normal = High\nAbnormal = Low
TEXT 240 1576 Left 2 ;Real:3.9Meg\nSimulation:220K
TEXT -696 432 Left 2 !.model LED D(IS=2e-19 N=2 RS=5 BV=30 IBV=1e-3)
TEXT 296 1688 Left 2 ;.ic V(RC)=0
TEXT -1368 144 Left 2 !.param Vrms=220
TEXT -1264 336 Right 2 ;Reducer
TEXT -1360 448 Left 2 ;Increaser
TEXT -1368 304 Left 2 !.param DECR=70
TEXT -1368 416 Left 2 !.param INCR=60
TEXT 816 176 Left 2 ;12V\n1W
TEXT 240 328 Left 2 ;1W
TEXT 88 144 Left 2 ;MOV\n10D471K
TEXT -272 104 Left 2 ;250mA
TEXT -944 872 Left 2 ;x53
TEXT -992 1568 Left 2 ;270Vrms
TEXT -1256 1568 Left 2 ;160Vrms
TEXT -528 -200 Left 2 ;2W
TEXT -528 -48 Left 2 ;400V
TEXT -696 464 Left 2 !.model SW SW(Ron=1u Roff=100Meg Vt=5)
TEXT -1264 0 Left 2 ;5A
TEXT -344 -112 Left 2 ;S1=Relay Contact
TEXT -1464 -424 Left 3 ;External Circuit
TEXT 672 192 Left 2 ;35V
TEXT -696 504 Left 2 ;GitHub.com/AliRezaJoodi
TEXT -1528 1520 Left 2 ;5V1
TEXT -328 824 Left 2 ;Hysteresis
TEXT 1136 184 Left 2 ;9V1\n1W
TEXT 240 120 Left 2 ;400V
RECTANGLE Normal -1472 528 -800 -400 2
